/**
 * jquery-ahm: ajax html modification jquery plugin
 * -uses jquery-do @ git@github.com:homebase/jquerydo.git
 * 
 * @author    Sergey <parf@comfi.com>, Jusun <jusun@comfi.com>
 * @copyright 2011 Comfi.com, Sergey Porfiriev, Jusun Lee 
 * @license   MIT License: http://www.jqueryahm.com/license
 * @version   1.5.0
 * @requires  jQuery 1.5+
 */
jQuery.extend({ahm:function(c,b){var d={url:c,dataType:"json"};if(b){$.extend(d,b)}var e=$.ajax(d);e.success(function(g){$.each(g,function(i,k){var j=i.split("/");var h=j[0];var l=j[1]?j[1]:"html";a(h,l,k)})});var a=function(g,j,i){if(typeof i=="object"){$.each(i,function(k,l){if(typeof l=="string"&&l.indexOf("function")==0){i[k]=window["eval"]("("+l+")")}else{if(l=="this"){i[k]=b.context}}})}if(g=="this"){g=b.context}if(i=="this"){i=b.context}if(g){var h=$(g)}else{if(jQuery[j]){var h=jQuery}else{if(window[j]){var h=window}else{if((f=window["eval"](j))&&(j="custom")){var h={custom:f}}else{return alert("ahm: undefined callback="+j)}}}}if(typeof h[j]=="function"){if($.isArray(i)){h[j]["apply"](h,i)}else{if(i){h[j](i)}else{h[j]()}}}else{h[j]=i}};return false},ahm_form:function(c,a){var c=$(c);if(c.is("form")==false){c=c.closest("form")}var d=c.find(":submit");var b={type:c.attr("method"),data:c.serialize(),context:c,beforeSend:function(g,e){d.attr("disabled","disabled")},complete:function(e,g){d.removeAttr("disabled")}};$.extend(b,a);return $.ahm(c.attr("action"),b)},do_loaded:[],"do":function(){var args=[].slice.apply(arguments);var url=args.shift();var callback=args.shift();if(url[0]===":"){url="/js/"+url.substring(1)+".js"}if(typeof callback!=="function"){var cb=callback;callback=function(){eval(cb).apply(window,args)}}if($.do_loaded.indexOf(url)>-1){callback();return}$.do_loaded.push(url);$.getScript(url).done(callback)}});$(function(){$("body").delegate("a.ahm","click",function(){return $.ahm(this.href,{context:this})});$("body").delegate("form.ahm","submit",function(){return $.ahm_form(this)});$("div.ahm,span.ahm").each(function(){var a=$(this);if(a.attr("data-url")){if(a.attr("data-delay")){setTimeout(function(){$.ahm(a.attr("data-url"),{context:a})},a.attr("data-delay"))}else{$.ahm(a.attr("data-url"),{context:a})}}})});